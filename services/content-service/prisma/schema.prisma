generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x", "debian-openssl-3.0.x", "linux-musl-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Author {
  id          String    @id @default(uuid())
  userId      String    @unique @map("user_id")
  name        String
  email       String
  bio         String?
  avatarUrl   String?   @map("avatar_url")
  socialLinks Json      @default("{}") @map("social_links")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  comments    Comment[]
  content     Content[]

  @@map("authors")
}

model Category {
  id          String     @id @default(uuid())
  name        String     @unique
  slug        String     @unique
  description String?
  parentId    String?    @map("parent_id")
  icon        String?
  sortOrder   Int        @default(0) @map("sort_order")
  isActive    Boolean    @default(true) @map("is_active")
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  parent      Category?  @relation("CategoryTree", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryTree")
  content     Content[]

  @@map("categories")
}

model Tag {
  id         String       @id @default(uuid())
  name       String       @unique
  slug       String       @unique
  color      String       @default("#3B82F6")
  usageCount Int          @default(0) @map("usage_count")
  createdAt  DateTime     @default(now()) @map("created_at")
  content    ContentTag[]

  @@map("tags")
}

model Content {
  id                 String        @id @default(uuid())
  title              String
  slug               String        @unique
  excerpt            String?
  body               String
  contentType        ContentType   @map("content_type")
  status             ContentStatus @default(draft)
  authorId           String        @map("author_id")
  categoryId         String?       @map("category_id")
  featuredImage      String?       @map("featured_image")
  featuredImageAlt   String?       @map("featured_image_alt")
  metaTitle          String?       @map("meta_title")
  metaDescription    String?       @map("meta_description")
  metaKeywords       String[]      @map("meta_keywords")
  publishedAt        DateTime?     @map("published_at")
  scheduledAt        DateTime?     @map("scheduled_at")
  viewCount          Int           @default(0) @map("view_count")
  likeCount          Int           @default(0) @map("like_count")
  shareCount         Int           @default(0) @map("share_count")
  readingTimeMinutes Int?          @map("reading_time_minutes")
  isFeatured         Boolean       @default(false) @map("is_featured")
  isTrending         Boolean       @default(false) @map("is_trending")
  allowComments      Boolean       @default(true) @map("allow_comments")
  customFields       Json          @default("{}") @map("custom_fields")
  createdAt          DateTime      @default(now()) @map("created_at")
  updatedAt          DateTime      @updatedAt @map("updated_at")
  deletedAt          DateTime?     @map("deleted_at")
  comments           Comment[]
  author             Author        @relation(fields: [authorId], references: [id])
  category           Category?     @relation(fields: [categoryId], references: [id])
  likes              ContentLike[]
  tags               ContentTag[]
  views              ContentView[]

  @@index([status])
  @@index([contentType])
  @@index([authorId])
  @@index([categoryId])
  @@index([publishedAt])
  @@index([slug])
  @@index([isFeatured])
  @@index([isTrending])
  @@map("content")
}

model ContentTag {
  contentId String  @map("content_id")
  tagId     String  @map("tag_id")
  content   Content @relation(fields: [contentId], references: [id], onDelete: Cascade)
  tag       Tag     @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([contentId, tagId])
  @@map("content_tags")
}

model Comment {
  id         String    @id @default(uuid())
  contentId  String    @map("content_id")
  authorId   String    @map("author_id")
  parentId   String?   @map("parent_id")
  body       String
  isApproved Boolean   @default(false) @map("is_approved")
  isFlagged  Boolean   @default(false) @map("is_flagged")
  likeCount  Int       @default(0) @map("like_count")
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")
  author     Author    @relation(fields: [authorId], references: [id])
  content    Content   @relation(fields: [contentId], references: [id], onDelete: Cascade)
  parent     Comment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies    Comment[] @relation("CommentReplies")

  @@index([contentId])
  @@index([authorId])
  @@map("comments")
}

model ContentView {
  id        String   @id @default(uuid())
  contentId String   @map("content_id")
  userId    String?  @map("user_id")
  ipAddress String?  @map("ip_address")
  userAgent String?  @map("user_agent")
  viewedAt  DateTime @default(now()) @map("viewed_at")
  content   Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@index([contentId])
  @@index([viewedAt])
  @@map("content_views")
}

model ContentLike {
  contentId String   @map("content_id")
  userId    String   @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")
  content   Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@id([contentId, userId])
  @@map("content_likes")
}

model MediaAsset {
  id               String   @id @default(uuid())
  filename         String
  originalFilename String   @map("original_filename")
  filePath         String   @map("file_path")
  fileSize         BigInt   @map("file_size")
  mimeType         String   @map("mime_type")
  width            Int?
  height           Int?
  uploadedBy       String   @map("uploaded_by")
  altText          String?  @map("alt_text")
  createdAt        DateTime @default(now()) @map("created_at")

  @@index([uploadedBy])
  @@map("media_assets")
}

model Tutorial {
  id              Int                @id @default(autoincrement())
  slug            String             @unique
  title           String
  description     String?
  icon            String?            @db.VarChar(100)
  difficultyLevel DifficultyLevel?   @map("difficulty_level")
  colorTheme      String?            @map("color_theme") @db.VarChar(50)
  estimatedHours  Int?               @map("estimated_hours")
  isPublished     Boolean            @default(false) @map("is_published")
  displayOrder    Int                @default(0) @map("display_order")
  metaTags        Json?              @map("meta_tags")
  stats           Json               @default("{\"total_views\": 0, \"total_topics\": 0}")
  createdAt       DateTime           @default(now()) @map("created_at")
  updatedAt       DateTime           @updatedAt @map("updated_at")
  progress        TutorialProgress[]
  sections        TutorialSection[]

  @@index([slug])
  @@index([isPublished, displayOrder])
  @@map("tutorials")
}

model TutorialSection {
  id           Int             @id @default(autoincrement())
  tutorialId   Int             @map("tutorial_id")
  slug         String
  title        String
  description  String?
  icon         String?         @db.VarChar(50)
  displayOrder Int             @default(0) @map("display_order")
  createdAt    DateTime        @default(now()) @map("created_at")
  updatedAt    DateTime        @updatedAt @map("updated_at")
  tutorial     Tutorial        @relation(fields: [tutorialId], references: [id], onDelete: Cascade)
  topics       TutorialTopic[]

  @@unique([tutorialId, slug])
  @@index([tutorialId, displayOrder])
  @@index([tutorialId, slug])
  @@map("tutorial_sections")
}

model TutorialTopic {
  id                Int                @id @default(autoincrement())
  sectionId         Int                @map("section_id")
  slug              String
  title             String
  content           String
  codeExamples      Json?              @map("code_examples")
  estimatedReadTime Int                @default(5) @map("estimated_read_time")
  displayOrder      Int                @default(0) @map("display_order")
  hasAudio          Boolean            @default(false) @map("has_audio")
  audioUrl          String?            @map("audio_url") @db.VarChar(500)
  audioDuration     Int?               @map("audio_duration")
  hasVideo          Boolean            @default(false) @map("has_video")
  videoUrl          String?            @map("video_url") @db.VarChar(500)
  videoDuration     Int?               @map("video_duration")
  isPublished       Boolean            @default(true) @map("is_published")
  viewsCount        Int                @default(0) @map("views_count")
  metaDescription   String?            @map("meta_description")
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")
  bookmarks         TutorialBookmark[]
  media             TutorialMedia[]
  progress          TutorialProgress[]
  section           TutorialSection    @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  @@unique([sectionId, slug])
  @@index([sectionId, displayOrder])
  @@index([sectionId, slug])
  @@index([isPublished])
  @@map("tutorial_topics")
}

model TutorialProgress {
  id               Int           @id @default(autoincrement())
  userId           Int           @map("user_id")
  tutorialId       Int           @map("tutorial_id")
  topicId          Int           @map("topic_id")
  isCompleted      Boolean       @default(false) @map("is_completed")
  lastReadAt       DateTime      @default(now()) @map("last_read_at")
  timeSpentSeconds Int           @default(0) @map("time_spent_seconds")
  createdAt        DateTime      @default(now()) @map("created_at")
  updatedAt        DateTime      @updatedAt @map("updated_at")
  topic            TutorialTopic @relation(fields: [topicId], references: [id], onDelete: Cascade)
  tutorial         Tutorial      @relation(fields: [tutorialId], references: [id], onDelete: Cascade)

  @@unique([userId, topicId])
  @@index([userId, tutorialId])
  @@index([topicId])
  @@map("tutorial_progress")
}

model TutorialBookmark {
  id        Int           @id @default(autoincrement())
  userId    Int           @map("user_id")
  topicId   Int           @map("topic_id")
  notes     String?
  createdAt DateTime      @default(now()) @map("created_at")
  topic     TutorialTopic @relation(fields: [topicId], references: [id], onDelete: Cascade)

  @@unique([userId, topicId])
  @@index([userId])
  @@map("tutorial_bookmarks")
}

model TutorialMedia {
  id          Int               @id @default(autoincrement())
  topicId     Int               @map("topic_id")
  mediaType   TutorialMediaType @map("media_type")
  url         String            @db.VarChar(500)
  duration    Int?
  fileSize    BigInt?           @map("file_size")
  mimeType    String?           @map("mime_type") @db.VarChar(100)
  status      MediaStatus       @default(processing)
  aiGenerated Boolean           @default(false) @map("ai_generated")
  createdAt   DateTime          @default(now()) @map("created_at")
  updatedAt   DateTime          @updatedAt @map("updated_at")
  topic       TutorialTopic     @relation(fields: [topicId], references: [id], onDelete: Cascade)

  @@index([topicId, mediaType])
  @@map("tutorial_media")
}

// =====================================================
// RESOURCES FEATURE MODELS
// =====================================================

model Resource {
  id                String   @id @default(uuid())
  slug              String   @unique
  title             String
  description       String?  @db.Text
  content           String   @db.Text
  category          String?
  tags              String[] @default([])
  sourceUrl         String?  @map("source_url") @db.VarChar(500)
  authorName        String?  @map("author_name")
  authorUrl         String?  @map("author_url") @db.VarChar(500)
  resourceType      String?  @map("resource_type")
  difficulty        String?  @default("Intermediate")
  estimatedReadTime Int?     @map("estimated_read_time")
  viewsCount        Int      @default(0) @map("views_count")
  isPublished       Boolean  @default(false) @map("is_published")
  displayOrder      Int      @default(0) @map("display_order")
  metaTags          Json?    @map("meta_tags")
  thumbnailUrl      String?  @map("thumbnail_url")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  @@index([slug])
  @@index([isPublished])
  @@index([category])
  @@map("resources")
}

enum ContentType {
  blog
  article
  news

  @@map("content_type")
}

enum ContentStatus {
  draft
  review
  published
  archived

  @@map("content_status")
}

enum DifficultyLevel {
  beginner
  intermediate
  advanced

  @@map("difficulty_level")
}

enum TutorialMediaType {
  audio
  video
  image

  @@map("tutorial_media_type")
}

enum MediaStatus {
  processing
  ready
  failed

  @@map("media_status")
}
